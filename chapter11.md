# 第十一章：时间序列因果推断

## 章节大纲

1. **引言**：时间序列数据的因果推断挑战与机遇
2. **格兰杰因果**：基于预测的因果概念
3. **向量自回归模型**：多变量时间序列的因果建模
4. **合成控制方法**：构造反事实的艺术
5. **因果影响分析**：贝叶斯结构时间序列方法
6. **行业案例**：Google搜索趋势与股价预测
7. **本章小结**
8. **练习题**
9. **常见陷阱与错误**
10. **最佳实践检查清单**

---

## 引言

时间序列数据在现实世界中无处不在——从股票价格到用户行为，从传感器读数到经济指标。在这些动态系统中识别因果关系面临独特的挑战：时间依赖性、序列相关性、以及潜在的反馈循环。本章将介绍专门针对时间序列数据的因果推断方法，帮助你理解如何在时间维度上建立和验证因果关系。

### 本章学习目标

- 理解时间序列因果推断与静态数据因果推断的区别
- 掌握格兰杰因果检验及其局限性
- 学会使用向量自回归模型进行多变量因果分析
- 理解合成控制方法的原理和应用场景
- 掌握贝叶斯结构时间序列的因果影响分析
- 能够在实际时间序列问题中选择合适的因果推断方法

### 时间序列因果推断的独特挑战

时间序列数据的因果推断面临以下独特挑战：

1. **时间依赖性**：观测值之间存在时间顺序和依赖关系，违反了许多传统方法的独立性假设
2. **动态效应**：因果效应可能随时间变化，存在即时效应、滞后效应和累积效应
3. **反馈循环**：变量之间可能存在双向因果关系，形成复杂的反馈机制
4. **混杂因素的时变性**：混杂因素本身可能随时间变化，增加了识别的复杂性
5. **有限样本**：对于单一时间序列，我们只有一条实现路径，限制了统计推断的能力

### 时间作为自然实验

时间维度为因果识别提供了独特的机会。时间的单向性确保了因果关系的时序约束：原因必须发生在结果之前。这个简单但强大的原则是许多时间序列因果推断方法的基础。

```
过去 ──────> 现在 ──────> 未来
  ↑            ↑            ↑
可观测      决策点      待预测
```

## 格兰杰因果

格兰杰因果（Granger Causality）是时间序列分析中最常用的因果概念之一。1969年，经济学家Clive Granger提出了基于预测的因果性定义：如果变量X的历史信息能够帮助预测变量Y的未来值，超出Y自身历史信息所能提供的预测能力，那么我们说X格兰杰因果于Y。

### 格兰杰因果的数学定义

设 $\{X_t\}$ 和 $\{Y_t\}$ 是两个平稳时间序列，$\Omega_t$ 表示到时刻 $t$ 为止的所有可用信息。格兰杰因果的正式定义：

$$X \text{ 格兰杰因果于 } Y \iff \sigma^2(Y_{t+1} | \Omega_t) < \sigma^2(Y_{t+1} | \Omega_t \setminus X_t)$$

其中 $\sigma^2$ 表示预测误差的方差，$\Omega_t \setminus X_t$ 表示从信息集中排除 $X$ 的历史信息。

### 格兰杰因果检验

实践中，格兰杰因果通常通过自回归模型来检验。考虑以下两个模型：

**限制模型**（仅使用Y的历史）：
$$Y_t = \alpha_0 + \sum_{i=1}^p \alpha_i Y_{t-i} + \epsilon_t$$

**非限制模型**（使用Y和X的历史）：
$$Y_t = \beta_0 + \sum_{i=1}^p \beta_i Y_{t-i} + \sum_{j=1}^q \gamma_j X_{t-j} + \nu_t$$

格兰杰因果检验的原假设是：$H_0: \gamma_1 = \gamma_2 = ... = \gamma_q = 0$

如果拒绝原假设，则认为X格兰杰因果于Y。检验统计量通常使用F统计量：

$$F = \frac{(RSS_r - RSS_{ur})/q}{RSS_{ur}/(T-p-q-1)}$$

其中 $RSS_r$ 和 $RSS_{ur}$ 分别是限制模型和非限制模型的残差平方和。

### 格兰杰因果的解释与局限

#### 重要性质

1. **非对称性**：X格兰杰因果于Y不意味着Y格兰杰因果于X
2. **传递性不成立**：X→Y且Y→Z不一定意味着X→Z
3. **时间优先性**：格兰杰因果尊重时间顺序，未来不能影响过去

#### 关键局限

格兰杰因果并不等同于真正的因果关系，这一点至关重要：

1. **预测性≠因果性**：格兰杰因果本质上是预测关系，而非因果关系。例如，鸡叫可能格兰杰因果于日出，但显然鸡叫不是日出的原因。

2. **潜在混杂因素**：如果存在未观测的第三变量Z同时影响X和Y，可能产生虚假的格兰杰因果关系。

```
    Z (未观测)
   ↙ ↘
  X → Y
  虚假的格兰杰因果
```

3. **瞬时因果**：如果X对Y的影响是瞬时的（在同一时间点），格兰杰因果检验可能无法检测到。

4. **非线性关系**：标准的格兰杰因果检验基于线性模型，可能错过非线性的因果关系。

### 多变量格兰杰因果

在实际应用中，我们通常需要考虑多个变量之间的格兰杰因果关系。条件格兰杰因果考虑了其他变量的影响：

$$Y_t = \alpha_0 + \sum_{i=1}^p \alpha_i Y_{t-i} + \sum_{j=1}^q \beta_j X_{t-j} + \sum_{k=1}^r \gamma_k Z_{t-k} + \epsilon_t$$

这种方法可以部分解决潜在混杂因素的问题，但要求我们观测到所有相关变量。

## 向量自回归模型（VAR）

向量自回归模型是分析多个时间序列变量之间动态关系的强大工具。VAR模型将系统中的每个变量表示为其自身和其他变量滞后值的线性函数，提供了一个统一的框架来分析多变量时间序列的因果结构。

### VAR模型的基本形式

一个包含 $k$ 个变量的 $p$ 阶VAR模型（记为VAR(p)）可以表示为：

$$\mathbf{y}_t = \mathbf{c} + \mathbf{A}_1 \mathbf{y}_{t-1} + \mathbf{A}_2 \mathbf{y}_{t-2} + ... + \mathbf{A}_p \mathbf{y}_{t-p} + \mathbf{u}_t$$

其中：
- $\mathbf{y}_t = (y_{1t}, y_{2t}, ..., y_{kt})'$ 是 $k \times 1$ 的变量向量
- $\mathbf{c}$ 是 $k \times 1$ 的常数向量
- $\mathbf{A}_i$ 是 $k \times k$ 的系数矩阵
- $\mathbf{u}_t$ 是 $k \times 1$ 的误差向量，满足 $E[\mathbf{u}_t] = 0$，$E[\mathbf{u}_t\mathbf{u}_t'] = \Sigma_u$

### 结构VAR与简化VAR

#### 结构VAR (SVAR)

结构VAR模型明确建模变量之间的同期因果关系：

$$\mathbf{B}_0 \mathbf{y}_t = \mathbf{c} + \mathbf{B}_1 \mathbf{y}_{t-1} + ... + \mathbf{B}_p \mathbf{y}_{t-p} + \mathbf{\epsilon}_t$$

其中 $\mathbf{B}_0$ 捕获同期效应，$\mathbf{\epsilon}_t$ 是结构冲击。

#### 识别问题

从简化VAR到结构VAR需要施加识别约束。常用的识别策略包括：

1. **短期约束**（Cholesky分解）：假设变量之间存在递归的同期因果顺序
2. **长期约束**（Blanchard-Quah）：基于经济理论的长期效应约束
3. **符号约束**：基于理论预期的脉冲响应符号
4. **外部工具变量**：使用外生变量识别结构冲击

### 脉冲响应分析

脉冲响应函数（IRF）描述了系统对冲击的动态响应，是VAR模型因果分析的核心工具。

#### 脉冲响应函数的定义

对于VAR(1)模型 $\mathbf{y}_t = \mathbf{A}\mathbf{y}_{t-1} + \mathbf{u}_t$，移动平均表示为：

$$\mathbf{y}_t = \sum_{i=0}^{\infty} \mathbf{\Psi}_i \mathbf{u}_{t-i}$$

其中 $\mathbf{\Psi}_i = \mathbf{A}^i$。元素 $\psi_{jk,i}$ 表示变量 $k$ 在时期 $t-i$ 受到一单位冲击对变量 $j$ 在时期 $t$ 的影响。

#### 正交化脉冲响应

由于VAR误差通常相关，需要正交化处理。Cholesky分解是常用方法：

$$\Sigma_u = \mathbf{P}\mathbf{P}'$$

正交化脉冲响应为：$\mathbf{\Theta}_i = \mathbf{\Psi}_i \mathbf{P}$

### 方差分解

方差分解（FEVD）量化了每个结构冲击对预测误差方差的贡献，提供了因果重要性的度量。

$h$ 步预测误差方差分解：

$$\omega_{jk}(h) = \frac{\sum_{i=0}^{h-1} \theta_{jk,i}^2}{\sum_{k=1}^K \sum_{i=0}^{h-1} \theta_{jk,i}^2}$$

这表示变量 $k$ 的冲击对变量 $j$ 的 $h$ 步预测误差方差的贡献比例。

### VAR模型的因果推断应用

VAR模型在因果推断中的主要应用包括：

1. **政策效应评估**：分析货币政策、财政政策等的动态因果效应
2. **溢出效应分析**：研究市场间、国家间的冲击传导机制
3. **预测与情景分析**：基于因果结构进行条件预测
4. **因果网络构建**：通过VAR系数矩阵识别变量间的因果网络

## 合成控制方法

合成控制方法（Synthetic Control Method）是评估单一处理单元因果效应的强大工具，特别适用于比较案例研究。该方法通过构造一个"合成"的控制单元来估计反事实结果。

### 基本思想

当我们只有一个处理单元（如一个实施特定政策的地区）时，传统的因果推断方法难以应用。合成控制方法通过加权组合多个未处理单元来构造一个与处理单元相似的合成控制单元。

设处理单元为单元1，在时期 $T_0$ 后接受处理。潜在结果模型：
- $Y_{1t}^N$：单元1在时期 $t$ 未接受处理的潜在结果
- $Y_{1t}^I$：单元1在时期 $t$ 接受处理的潜在结果

处理效应：$\alpha_{1t} = Y_{1t}^I - Y_{1t}^N$，对于 $t > T_0$

关键挑战是 $Y_{1t}^N$ 不可观测。合成控制方法通过构造合成控制来估计它。

### 合成控制的构造

#### 权重选择

设有 $J$ 个潜在的控制单元。合成控制是这些单元的加权平均：

$$\hat{Y}_{1t}^N = \sum_{j=2}^{J+1} w_j Y_{jt}$$

权重 $\mathbf{w} = (w_2, ..., w_{J+1})'$ 满足：
- $w_j \geq 0$ 对所有 $j$
- $\sum_{j=2}^{J+1} w_j = 1$

#### 优化问题

权重通过最小化处理前期的预测误差来选择：

$$\min_{\mathbf{w}} ||\mathbf{X}_1 - \mathbf{X}_0\mathbf{w}||_V = \sqrt{(\mathbf{X}_1 - \mathbf{X}_0\mathbf{w})'V(\mathbf{X}_1 - \mathbf{X}_0\mathbf{w})}$$

其中：
- $\mathbf{X}_1$：处理单元的预测变量值
- $\mathbf{X}_0$：控制单元的预测变量矩阵
- $V$：反映预测变量相对重要性的权重矩阵
