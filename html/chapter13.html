<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>第十三章：反事实推理与结构因果模型</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="搜索..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">因果推断教程</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第一章：因果推断导论</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第二章：潜在结果框架</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第三章：图模型与因果图</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第四章：随机实验与因果识别</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第五章：观察性研究中的因果推断</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第六章：工具变量方法</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第七章：断点回归设计</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第八章：双重差分方法</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第九章：中介分析与路径分析</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第十章：异质性处理效应</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第十一章：时间序列因果推断</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第十二章：因果发现</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第十三章：反事实推理与结构因果模型</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第十四章：因果推断与机器学习</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第十五章：实践案例与工具</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="_1">第十三章：反事实推理与结构因果模型</h1>
<p>本章我们将深入探讨因果推断的最高层次——反事实推理。通过结构因果模型（SCM），我们不仅能回答"如果采取某个行动会发生什么"，更能回答"如果当初采取了不同的行动，结果会如何"。这种能力在法律责任判定、医疗决策和政策评估等领域具有重要价值。我们将系统学习Pearl的因果层级理论、SCM的构建方法、反事实查询的计算以及必要性与充分性概率的应用。</p>
<h2 id="131-pearl">13.1 Pearl因果层级</h2>
<p>Judea Pearl提出的因果层级（Ladder of Causation）为我们理解不同类型的因果问题提供了清晰的框架。这个层级将因果问题分为三个递进的层次，每个层次需要不同类型的信息和推理能力。</p>
<h3 id="1311-association">13.1.1 关联层（Association）</h3>
<p>关联层是最基础的层次，处理的是观察性问题："看到X时，Y会是什么？"</p>
<p><strong>数学表达</strong>：$P(Y|X)$</p>
<p>这一层只需要观察数据就能回答，是传统统计学和机器学习主要关注的领域。例如：</p>
<ul>
<li>"吸烟者患肺癌的概率是多少？"</li>
<li>"高学历者的平均收入是多少？"</li>
</ul>
<p>关联层的局限性在于无法区分相关性和因果性。即使我们观察到强相关，也不能断言存在因果关系。</p>
<h3 id="1312-intervention">13.1.2 干预层（Intervention）</h3>
<p>干预层处理的是行动问题："如果我做了X，Y会是什么？"</p>
<p><strong>数学表达</strong>：$P(Y|do(X))$</p>
<p>这里的$do(X)$表示主动干预，将X设置为某个值，而不是被动观察X等于某个值。这一层需要：</p>
<ul>
<li>实验数据，或</li>
<li>观察数据 + 因果假设（如后门准则）</li>
</ul>
<p>例如：</p>
<ul>
<li>"如果强制某人吸烟，他患肺癌的概率是多少？"</li>
<li>"如果提高最低工资，失业率会如何变化？"</li>
</ul>
<h3 id="1313-counterfactual">13.1.3 反事实层（Counterfactual）</h3>
<p>反事实层是最高层次，处理的是想象问题："如果X不同，Y会是什么？"</p>
<p><strong>数学表达</strong>：$P(Y_x|X', Y')$ </p>
<p>这表示：已知实际观察到$X'$和$Y'$，如果X的值是x（与实际不同），Y会是什么？</p>
<p>反事实问题的例子：</p>
<ul>
<li>"如果这个吸烟者当初没有吸烟，他现在还会患肺癌吗？"</li>
<li>"如果希拉里赢得了2016年大选，今天的失业率会是多少？"</li>
</ul>
<h3 id="1314">13.1.4 三层级的关系</h3>
<div class="codehilite"><pre><span></span><code>        反事实层
           ↑
        干预层  
           ↑
        关联层
</code></pre></div>

<p>重要性质：</p>
<ol>
<li><strong>层级不可逆</strong>：高层信息可以回答低层问题，但低层信息无法回答高层问题</li>
<li><strong>信息需求递增</strong>：每上升一层，需要更强的假设或更多的信息</li>
<li><strong>实际应用递减</strong>：越高层的问题越难在实践中精确回答</li>
</ol>
<h2 id="132-scm">13.2 结构因果模型（SCM）</h2>
<p>结构因果模型是形式化表达因果关系的数学框架，能够统一处理所有三个层级的因果问题。</p>
<h3 id="1321-scm">13.2.1 SCM的定义</h3>
<p>一个结构因果模型M由三部分组成：</p>
<p><strong>M = ⟨U, V, F⟩</strong></p>
<p>其中：</p>
<ul>
<li><strong>U</strong>：外生变量集合（未观测的背景变量）</li>
<li><strong>V</strong>：内生变量集合（模型中的变量）</li>
<li><strong>F</strong>：结构方程集合，每个$V_i ∈ V$都有一个方程：
  $$V_i = f_i(PA_i, U_i)$$
其中$PA_i$是$V_i$的父节点集合</li>
</ul>
<h3 id="1322">13.2.2 结构方程示例</h3>
<p>考虑一个简单的薪资模型：</p>
<div class="codehilite"><pre><span></span><code>U_E ~ N(0, 1)  # 教育的随机因素
U_S ~ N(0, 1)  # 薪资的随机因素

E = 2 + U_E                    # 教育年限
S = 3000 + 500*E + 1000*U_S    # 薪资
</code></pre></div>

<p>这个SCM告诉我们：</p>
<ul>
<li>教育年限E由基础值2和随机因素$U_E$决定</li>
<li>薪资S由基础工资3000、教育回报（每年500）和随机因素决定</li>
</ul>
<h3 id="1323-scm">13.2.3 从SCM到因果图</h3>
<p>SCM可以自然地转换为因果图（DAG）：</p>
<div class="codehilite"><pre><span></span><code>    U_E → E
           ↓
    U_S → S
</code></pre></div>

<p>简化表示（隐藏外生变量）：</p>
<div class="codehilite"><pre><span></span><code>    E → S
</code></pre></div>

<h3 id="1324-scm">13.2.4 SCM的干预操作</h3>
<p>在SCM中，干预$do(X=x)$通过替换相应的结构方程实现：</p>
<p>原始方程：$X = f_X(PA_X, U_X)$
干预后：$X = x$</p>
<p>这相当于：</p>
<ol>
<li>删除所有指向X的边</li>
<li>将X固定为常数x</li>
</ol>
<h2 id="133">13.3 反事实查询</h2>
<p>反事实推理是SCM最强大的功能之一，让我们能够回答"如果...会怎样"的问题。</p>
<h3 id="1331">13.3.1 反事实的定义</h3>
<p>反事实量$Y_x(u)$表示：在外生变量为u的情况下，如果设置X=x，Y的值是什么。</p>
<p>对于个体i，其反事实结果是：
$$Y_{x}^{(i)} = Y_x(U^{(i)})$$</p>
<h3 id="1332">13.3.2 三步法计算反事实</h3>
<p>Pearl提出了计算反事实的三步法：</p>
<p><strong>步骤1：溯因（Abduction）</strong>
使用观察数据推断外生变量U的值：
$$P(U|evidence)$$
<strong>步骤2：行动（Action）</strong>
在推断出的U下，应用干预$do(X=x)$，修改模型</p>
<p><strong>步骤3：预测（Prediction）</strong>
在修改后的模型中计算Y的值</p>
<h3 id="1333">13.3.3 实例：薪资反事实</h3>
<p>假设我们观察到某人：</p>
<ul>
<li>教育年限：E = 4年</li>
<li>薪资：S = 5000元</li>
</ul>
<p><strong>问题</strong>：如果这个人接受了6年教育，他的薪资会是多少？</p>
<p><strong>步骤1：溯因</strong>
从E = 4，推断：$U_E = 4 - 2 = 2$
从S = 5000，E = 4，推断：$U_S = (5000 - 3000 - 500*4)/1000 = 0$</p>
<p><strong>步骤2：行动</strong>
设置E = 6</p>
<p><strong>步骤3：预测</strong>
$S_{E=6} = 3000 + 500*6 + 1000*0 = 6000$</p>
<p>因此，反事实薪资是6000元。</p>
<h3 id="1334">13.3.4 反事实与潜在结果</h3>
<p>在Rubin因果模型中，潜在结果$Y(1), Y(0)$实际上就是反事实：</p>
<ul>
<li>$Y(1)$：如果接受处理的结果</li>
<li>$Y(0)$：如果不接受处理的结果</li>
</ul>
<p>个体因果效应：
$$ICE = Y(1) - Y(0) = Y_{T=1} - Y_{T=0}$$</p>
<h2 id="134">13.4 必要性与充分性概率</h2>
<p>在法律、医疗和政策评估中，我们经常需要判断某个原因对结果的责任程度。必要性和充分性概率提供了量化这种责任的框架。</p>
<h3 id="1341-probability-of-necessity-pn">13.4.1 必要性概率（Probability of Necessity, PN）</h3>
<p>必要性概率回答："如果原因没有发生，结果还会发生吗？"</p>
<p><strong>定义</strong>：
$$PN = P(Y_0 = 0 | X = 1, Y = 1)$$
这表示：在观察到X=1且Y=1的情况下，如果X=0，Y也会是0的概率。</p>
<p><strong>直观理解</strong>：</p>
<ul>
<li>PN高：X是Y的必要原因（没有X就没有Y）</li>
<li>PN低：即使没有X，Y也可能发生</li>
</ul>
<p><strong>法律应用</strong>：
在侵权法中，PN &gt; 0.5通常作为"若非因果关系"（but-for causation）的标准。</p>
<h3 id="1342-probability-of-sufficiency-ps">13.4.2 充分性概率（Probability of Sufficiency, PS）</h3>
<p>充分性概率回答："如果原因发生了，结果一定会发生吗？"</p>
<p><strong>定义</strong>：
$$PS = P(Y_1 = 1 | X = 0, Y = 0)$$
这表示：在观察到X=0且Y=0的情况下，如果X=1，Y也会是1的概率。</p>
<p><strong>直观理解</strong>：</p>
<ul>
<li>PS高：X是Y的充分原因（有X就有Y）</li>
<li>PS低：即使有X，Y也不一定发生</li>
</ul>
<h3 id="1343-probability-of-necessity-and-sufficiency-pns">13.4.3 必要充分性概率（Probability of Necessity and Sufficiency, PNS）</h3>
<p>PNS结合了必要性和充分性：</p>
<p><strong>定义</strong>：
$$PNS = P(Y_1 = 1, Y_0 = 0)$$
这表示：X=1时Y=1，且X=0时Y=0的概率。</p>
<p><strong>关系公式</strong>：
在单调性假设下（没有个体对处理有负面反应）：
$$PNS = P(Y|X=1) - P(Y|X=0)$$</p>
<h3 id="1344">13.4.4 计算示例</h3>
<p>考虑一个药物治疗的例子：</p>
<p>观察数据：</p>
<ul>
<li>$P(康复|服药) = 0.8$</li>
<li>$P(康复|未服药) = 0.3$</li>
</ul>
<p>在单调性假设下：</p>
<ul>
<li>$PNS = 0.8 - 0.3 = 0.5$</li>
</ul>
<p>这意味着50%的患者是"反应者"——服药会康复，不服药不会康复。</p>
<h3 id="1345">13.4.5 边界关系</h3>
<p>即使无法精确计算PN、PS，我们也可以得到有用的边界：</p>
<p><strong>PN的边界</strong>：
$$\max(0, P(Y|X=1) - P(Y|X=0)) \leq PN \leq \min(P(Y|X=1), P(\bar{Y}|X=0))$$
<strong>PS的边界</strong>：
$$\max(0, P(Y|X=1) - P(Y|X=0)) \leq PS \leq \min(P(\bar{Y}|X=0), P(Y|X=1))$$</p>
<h2 id="135">13.5 行业案例：特斯拉自动驾驶事故责任判定</h2>
<h3 id="_2">背景</h3>
<p>2023年，一辆开启Autopilot的特斯拉Model 3在高速公路上发生事故，撞上了前方突然变道的卡车。事故造成特斯拉驾驶员受伤，引发了关于自动驾驶系统责任的诉讼。</p>
<p>关键事实：</p>
<ul>
<li>事故发生时Autopilot已开启</li>
<li>驾驶员在事故前3秒收到了接管警告</li>
<li>驾驶员未能及时接管</li>
<li>系统日志显示传感器正常工作</li>
</ul>
<h3 id="_3">因果模型构建</h3>
<p>我们构建如下SCM：</p>
<div class="codehilite"><pre><span></span><code>变量定义：

<span class="k">-</span> A: Autopilot状态 (1=开启, 0=关闭)
<span class="k">-</span> W: 警告发出 (1=是, 0=否)
<span class="k">-</span> R: 驾驶员反应 (1=及时, 0=不及时)
<span class="k">-</span> S: 传感器检测 (1=正常, 0=异常)
<span class="k">-</span> C: 碰撞发生 (1=是, 0=否)

结构方程：
S = f_S(U_S)  # 传感器状态
W = A * S      # 只有Autopilot开启且传感器正常才发警告
R = f_R(W, U_R)  # 驾驶员反应取决于警告和个人因素
C = f_C(A, R, S, U_C)  # 碰撞取决于多个因素
</code></pre></div>

<h3 id="_4">反事实分析</h3>
<p><strong>问题1</strong>：如果Autopilot没有开启，事故还会发生吗？</p>
<p>这是必要性问题：$P(C_{A=0} = 0 | A=1, C=1)$</p>
<p>分析步骤：</p>
<ol>
<li><strong>溯因</strong>：从观察数据推断驾驶员的反应能力和环境条件</li>
<li><strong>干预</strong>：设置A=0（Autopilot关闭）</li>
<li><strong>预测</strong>：计算人工驾驶下的碰撞概率</li>
</ol>
<p>根据类似事故统计：</p>
<ul>
<li>人工驾驶在相同场景下的事故率：15%</li>
<li>Autopilot在此场景下的事故率：5%</li>
</ul>
<p>因此：$PN ≈ 0.85$</p>
<p><strong>问题2</strong>：Autopilot的存在是否增加了事故风险？</p>
<p>计算充分性概率：$P(C_{A=1} = 1 | A=0, C=0)$</p>
<p>这需要评估：在没有使用Autopilot且没有发生事故的情况下，如果使用了Autopilot，发生事故的概率。</p>
<h3 id="_5">责任分配</h3>
<p>基于反事实分析，我们可以量化各方责任：</p>
<ol>
<li>
<p><strong>Autopilot系统责任</strong>：
   - 必要性概率PN = 0.85表明，没有Autopilot事故很可能不会发生
   - 但系统确实发出了警告</p>
</li>
<li>
<p><strong>驾驶员责任</strong>：
   - 未能及时响应警告
   - 过度依赖自动驾驶系统</p>
</li>
<li>
<p><strong>环境因素</strong>：
   - 前车突然变道
   - 道路条件</p>
</li>
</ol>
<h3 id="_6">法律启示</h3>
<p>这个案例展示了反事实推理在法律责任判定中的应用：</p>
<ol>
<li><strong>因果贡献度量化</strong>：通过PN、PS等指标量化各因素的贡献</li>
<li><strong>多重原因处理</strong>：SCM能够处理多个原因同时作用的情况</li>
<li><strong>证据标准</strong>：PN &gt; 0.5可作为民事诉讼的证据标准</li>
<li><strong>政策制定</strong>：基于反事实分析改进自动驾驶法规</li>
</ol>
<h3 id="_7">技术改进建议</h3>
<p>基于因果分析，特斯拉可以：</p>
<ol>
<li><strong>增强预警系统</strong>：提高警告的显著性</li>
<li><strong>驾驶员监控</strong>：实时监测驾驶员注意力</li>
<li><strong>渐进式接管</strong>：设计更平滑的控制权转移机制</li>
<li><strong>场景识别</strong>：改进高风险场景的识别算法</li>
</ol>
<h2 id="136">13.6 本章小结</h2>
<p>本章我们深入探讨了因果推断的最高层次——反事实推理和结构因果模型。主要内容包括：</p>
<p><strong>核心概念</strong>：</p>
<ol>
<li><strong>Pearl因果层级</strong>：关联、干预、反事实三个递进层次</li>
<li><strong>结构因果模型</strong>：统一处理所有因果问题的数学框架</li>
<li><strong>反事实查询</strong>：通过溯因-行动-预测三步法计算</li>
<li><strong>必要性与充分性概率</strong>：量化因果责任的关键指标</li>
</ol>
<p><strong>关键公式</strong>：</p>
<ul>
<li>干预：$P(Y|do(X))$</li>
<li>反事实：$Y_x(u) = Y_{M_x}(u)$</li>
<li>必要性概率：$PN = P(Y_0 = 0 | X = 1, Y = 1)$</li>
<li>充分性概率：$PS = P(Y_1 = 1 | X = 0, Y = 0)$</li>
<li>必要充分性：$PNS = P(Y_1 = 1, Y_0 = 0)$</li>
</ul>
<p><strong>实践要点</strong>：</p>
<ul>
<li>SCM提供了从数据到反事实的完整推理路径</li>
<li>反事实分析在法律责任、医疗决策等领域具有重要应用</li>
<li>必要性和充分性概率帮助量化因果贡献</li>
<li>单调性假设简化了许多计算，但需要谨慎验证</li>
</ul>
<h2 id="137">13.7 练习题</h2>
<h3 id="_8">基础题</h3>
<p><strong>练习13.1</strong> Pearl因果层级理解
对于以下问题，判断它们属于哪个因果层级（关联/干预/反事实）：
a) "糖尿病患者的平均血糖水平是多少？"
b) "如果给所有人注射胰岛素，血糖会下降多少？"
c) "如果这个糖尿病患者昨天注射了胰岛素，他今天的血糖会是多少？"
d) "看到某人血糖高，他患糖尿病的概率是多少？"</p>
<details>
<summary>提示</summary>
<p>关注问题是否涉及：观察（关联）、行动（干预）、或已知事实下的假设（反事实）</p>
</details>
<details>
<summary>答案</summary>
<p>a) 关联层 - 纯观察性问题
b) 干预层 - 涉及主动行动do(注射胰岛素)
c) 反事实层 - 对特定个体的过去进行假设
d) 关联层 - 条件概率，观察性推断</p>
</details>
<p><strong>练习13.2</strong> SCM计算
给定如下结构因果模型：</p>
<div class="codehilite"><pre><span></span><code>U_X ~ Bernoulli(0.5)
U_Y ~ Bernoulli(0.3)
X = U_X
Y = X ⊕ U_Y  (异或运算)
</code></pre></div>

<p>计算：
a) P(Y=1)
b) P(Y=1|do(X=1))
c) 对于观察到X=1, Y=0的个体，计算反事实$Y_{X=0}$</p>
<details>
<summary>提示</summary>
<p>异或运算：相同为0，不同为1。先计算边际概率，再考虑干预和反事实。</p>
</details>
<details>
<summary>答案</summary>
<p>a) P(Y=1) = P(X=0,U_Y=1) + P(X=1,U_Y=0) = 0.5×0.3 + 0.5×0.7 = 0.5</p>
<p>b) do(X=1)后，Y = 1 ⊕ U_Y，所以P(Y=1|do(X=1)) = P(U_Y=0) = 0.7</p>
<p>c) 观察X=1, Y=0，推断U_Y=1（因为1⊕1=0）
   反事实：若X=0，则Y = 0⊕1 = 1
   因此$Y_{X=0} = 1$</p>
</details>
<p><strong>练习13.3</strong> 必要性概率计算
某医院数据显示：</p>
<ul>
<li>接种疫苗且未感染：800人</li>
<li>接种疫苗且感染：200人  </li>
<li>未接种且未感染：300人</li>
<li>未接种且感染：700人</li>
</ul>
<p>在单调性假设下，计算：
a) 疫苗的必要充分性概率PNS
b) 估计必要性概率PN的下界</p>
<details>
<summary>提示</summary>
<p>单调性假设意味着没有人因接种疫苗反而更容易感染。使用边界公式。</p>
</details>
<details>
<summary>答案</summary>
<p>a) P(感染|未接种) = 700/1000 = 0.7
   P(感染|接种) = 200/1000 = 0.2
   PNS = 0.7 - 0.2 = 0.5</p>
<p>b) PN下界 = max(0, P(Y|X=1) - P(Y|X=0))
   这里Y=未感染，X=接种
   P(未感染|接种) = 0.8
   P(未感染|未接种) = 0.3
   PN下界 = 0.8 - 0.3 = 0.5</p>
</details>
<h3 id="_9">挑战题</h3>
<p><strong>练习13.4</strong> 多原因反事实
考虑火灾案例，有两个纵火犯A和B：</p>
<div class="codehilite"><pre><span></span><code><span class="n">SCM</span><span class="o">:</span>
<span class="err">火灾</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">B</span>
<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">(</span><span class="n">A纵火了</span><span class="o">)</span>
<span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">(</span><span class="n">B纵火了</span><span class="o">)</span>
</code></pre></div>

<p>现在火灾发生了。计算：
a) A对火灾的必要性概率
b) 如果只有A或B其中一人纵火，火灾就会发生，这种情况下的责任如何分配？
c) 设计一个更合理的SCM来处理共同原因</p>
<details>
<summary>提示</summary>
<p>OR逻辑意味着任一原因都充分。考虑Shapley值等合作博弈概念。</p>
</details>
<details>
<summary>答案</summary>
<p>a) PN_A = P(火灾_{A=0}=0 | A=1, B=1, 火灾=1)
   由于B=1，即使A=0，火灾仍会发生
   因此PN_A = 0</p>
<p>b) 两个纵火犯都不是必要的（PN=0），但都是充分的（PS=1）
   可以使用Shapley值：每人分配50%责任
   或考虑时间顺序、故意程度等其他因素</p>
<p>c) 更合理的SCM：
   <code>火灾强度 = α*A + β*B + γ*A*B + U
   火灾 = 1(火灾强度 &gt; 阈值)</code>
   这允许协同效应和部分贡献</p>
</details>
<p><strong>练习13.5</strong> 反事实推理悖论
"如果我没有买彩票，我就不会中奖"——这看起来显然正确。但考虑：</p>
<ul>
<li>实际：我买了彩票（T=1），没中奖（W=0）</li>
<li>反事实：如果我没买（T=0），中奖概率W_{T=0}=?</li>
</ul>
<p>解释为什么这个反事实是0，以及这与直觉的关系。</p>
<details>
<summary>提示</summary>
<p>区分事前（ex-ante）和事后（ex-post）视角。考虑信息的作用。</p>
</details>
<details>
<summary>答案</summary>
<p>反事实W_{T=0}=0是正确的，因为：</p>
<ol>
<li>观察到W=0意味着我的彩票号码不是中奖号码</li>
<li>这个信息在反事实世界中保持不变</li>
<li>因此即使没买彩票，"我的号码"仍不是中奖号码</li>
</ol>
<p>直觉vs形式化：</p>
<ul>
<li>直觉：基于事前概率（买彩票才有机会）</li>
<li>形式化：基于事后信息（已知号码不中奖）</li>
</ul>
<p>这说明反事实推理必须明确信息集和时间点。</p>
</details>
<p><strong>练习13.6</strong> 法律因果链
某公司数据泄露案：</p>
<ul>
<li>黑客攻击了系统（H=1）</li>
<li>员工未及时更新补丁（P=0）</li>
<li>数据被窃取（D=1）</li>
</ul>
<p>SCM：</p>
<div class="codehilite"><pre><span></span><code>D = H * (1-P)  # 只有黑客攻击且无补丁才泄露
</code></pre></div>

<p>问题：
a) 计算员工失职的必要性概率
b) 如果补丁只能阻止50%的攻击，如何修改模型？
c) 讨论法律责任分配的原则</p>
<details>
<summary>提示</summary>
<p>考虑预防责任vs直接责任。概率性防护需要随机变量建模。</p>
</details>
<details>
<summary>答案</summary>
<p>a) PN_员工 = P(D_{P=1}=0 | H=1, P=0, D=1)
   如果P=1（及时更新），则D=1*(1-1)=0
   因此PN_员工 = 1（员工失职是必要原因）</p>
<p>b) 修改模型：
   <code>U_D ~ Bernoulli(0.5)  # 补丁效果的随机性
   D = H * (P*U_D + (1-P)*1)</code>
   现在补丁只提供概率性保护</p>
<p>c) 责任分配原则：</p>
<ul>
<li>直接原因（黑客）vs促成原因（员工）</li>
<li>注意义务：员工有更新补丁的职责</li>
<li>可预见性：数据泄露是可预见的后果</li>
<li>最后清晰机会：员工有最后机会阻止</li>
</ul>
<p>建议：主要责任在黑客，员工承担过失责任</p>
</details>
<p><strong>练习13.7</strong> 开放性思考：反事实的哲学含义
David Lewis说："反事实是关于最相似的可能世界的陈述。"
讨论：
a) SCM如何形式化"最相似"的概念？
b) 反事实推理在人工智能中的作用
c) 机器能否真正理解反事实？</p>
<details>
<summary>提示</summary>
<p>考虑外生变量U的作用、干预的最小性、以及符号vs语义理解。</p>
</details>
<details>
<summary>答案</summary>
<p>a) SCM中的"最相似"：</p>
<ul>
<li>保持所有外生变量U不变</li>
<li>只改变干预变量</li>
<li>其他内生变量按结构方程传播</li>
<li>这定义了独特的反事实世界</li>
</ul>
<p>b) AI中的作用：</p>
<ul>
<li>解释性：理解模型决策</li>
<li>鲁棒性：评估不同情况下的表现</li>
<li>公平性：检测歧视性决策</li>
<li>规划：评估行动后果</li>
</ul>
<p>c) 机器理解反事实：</p>
<ul>
<li>形式层面：可以计算反事实查询</li>
<li>语义层面：缺乏真正的想象力</li>
<li>实用层面：足以支持决策</li>
<li>哲学争议：理解vs模拟的区别</li>
</ul>
<p>关键洞察：SCM提供了反事实的计算框架，但"理解"仍是开放问题。</p>
</details>
<h2 id="138">13.8 常见陷阱与错误</h2>
<p>在应用反事实推理和SCM时，研究者经常遇到以下问题：</p>
<h3 id="1">1. 混淆不同因果层级</h3>
<p><strong>错误</strong>：用观察数据直接回答反事实问题</p>
<div class="codehilite"><pre><span></span><code>错误推理：&quot;吸烟者肺癌率30%，所以这个吸烟肺癌患者如果不吸烟，
         有70%概率不会得肺癌&quot;
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>认识到$P(Y|X) ≠ P(Y_x)$</li>
<li>需要SCM或额外假设才能从观察数据推导反事实</li>
<li>个体反事实可能与群体统计大相径庭</li>
</ul>
<h3 id="2">2. 忽视模型假设</h3>
<p><strong>错误</strong>：盲目应用单调性假设</p>
<div class="codehilite"><pre><span></span><code>场景：教育对收入的影响
错误：&quot;没有人会因为多受教育而收入降低&quot;
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>某些情况下过度教育确实可能降低收入</li>
<li>始终验证假设的合理性</li>
<li>进行敏感性分析</li>
</ul>
<h3 id="3">3. 反事实的时间不一致</h3>
<p><strong>错误</strong>：混淆不同时间点的反事实</p>
<div class="codehilite"><pre><span></span><code>问题：&quot;如果没有疫情，现在的失业率是多少？&quot;
陷阱：没有明确是2020年初没有疫情，还是疫情从未发生
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>明确反事实的时间点</li>
<li>区分预防性反事实vs治疗性反事实</li>
<li>考虑路径依赖效应</li>
</ul>
<h3 id="4">4. 过度解释必要性概率</h3>
<p><strong>错误</strong>：PN=0.6就断定存在因果关系</p>
<div class="codehilite"><pre><span></span><code>错误：&quot;PN&gt;0.5，所以X导致了Y&quot;
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>PN衡量的是特定个体的反事实依赖</li>
<li>不等同于一般性因果关系</li>
<li>需要结合PS、PNS综合判断</li>
</ul>
<h3 id="5">5. 忽视识别性问题</h3>
<p><strong>错误</strong>：假设所有反事实都可识别</p>
<div class="codehilite"><pre><span></span><code>问题：从观察数据计算P(Y₁|X=0)
陷阱：这需要跨越潜在结果，通常不可识别
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>检查反事实查询是否可识别</li>
<li>使用边界when无法点识别</li>
<li>明确陈述识别假设</li>
</ul>
<h3 id="6">6. 循环定义</h3>
<p><strong>错误</strong>：在SCM中创建循环依赖</p>
<div class="codehilite"><pre><span></span><code>错误的SCM：
X = f(Y, U_X)
Y = g(X, U_Y)
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>确保SCM是无环的</li>
<li>使用时间索引处理动态系统</li>
<li>考虑平衡方程而非因果方程</li>
</ul>
<h3 id="7">7. 混淆结构方程和回归方程</h3>
<p><strong>错误</strong>：将回归系数解释为因果参数</p>
<div class="codehilite"><pre><span></span><code>回归：Y = α + βX + ε
错误：&quot;β是X对Y的因果效应&quot;
</code></pre></div>

<p><strong>正确方法</strong>：</p>
<ul>
<li>结构方程描述因果机制</li>
<li>回归方程描述统计关联</li>
<li>需要因果假设连接两者</li>
</ul>
<h2 id="139">13.9 最佳实践检查清单</h2>
<h3 id="_10">模型构建阶段</h3>
<ul>
<li>[ ] <strong>明确因果问题层级</strong></li>
<li>确定是关联、干预还是反事实问题</li>
<li>
<p>选择适当的分析框架</p>
</li>
<li>
<p>[ ] <strong>构建合理的SCM</strong></p>
</li>
<li>基于领域知识确定变量关系</li>
<li>确保无环性</li>
<li>
<p>明确外生变量假设</p>
</li>
<li>
<p>[ ] <strong>验证模型假设</strong></p>
</li>
<li>检查单调性、独立性等假设</li>
<li>进行假设的合理性论证</li>
<li>记录所有关键假设</li>
</ul>
<h3 id="_11">分析执行阶段</h3>
<ul>
<li>[ ] <strong>正确应用三步法</strong></li>
<li>溯因：准确推断外生变量</li>
<li>行动：正确实施干预</li>
<li>
<p>预测：在修改模型中计算结果</p>
</li>
<li>
<p>[ ] <strong>检查识别性</strong></p>
</li>
<li>确认反事实查询是否可识别</li>
<li>如不可识别，计算边界</li>
<li>
<p>考虑额外假设或数据需求</p>
</li>
<li>
<p>[ ] <strong>计算多个指标</strong></p>
</li>
<li>不仅计算PN，也计算PS和PNS</li>
<li>比较不同指标的含义</li>
<li>提供全面的因果picture</li>
</ul>
<h3 id="_12">结果解释阶段</h3>
<ul>
<li>[ ] <strong>谨慎解释结果</strong></li>
<li>区分个体vs群体效应</li>
<li>明确时间和条件背景</li>
<li>
<p>避免过度推广</p>
</li>
<li>
<p>[ ] <strong>进行敏感性分析</strong></p>
</li>
<li>测试对关键假设的敏感性</li>
<li>提供结果的不确定性范围</li>
<li>
<p>讨论模型局限性</p>
</li>
<li>
<p>[ ] <strong>沟通要点</strong></p>
</li>
<li>用通俗语言解释反事实</li>
<li>提供直观的例子</li>
<li>强调关键假设和限制</li>
</ul>
<h3 id="_13">应用实践阶段</h3>
<ul>
<li>[ ] <strong>法律与政策应用</strong></li>
<li>明确责任归属标准</li>
<li>考虑多重原因情况</li>
<li>
<p>提供可操作的建议</p>
</li>
<li>
<p>[ ] <strong>决策支持</strong></p>
</li>
<li>评估不同行动的反事实后果</li>
<li>量化决策的因果影响</li>
<li>
<p>提供风险评估</p>
</li>
<li>
<p>[ ] <strong>模型验证</strong></p>
</li>
<li>使用已知反事实验证模型</li>
<li>与领域专家讨论合理性</li>
<li>持续改进和更新模型</li>
</ul>
<hr />
<p><em>本章深入探讨了因果推断的最高层级——反事实推理。通过SCM框架，我们能够回答"如果...会怎样"的深层因果问题，这在法律、医疗、政策等领域具有重要价值。下一章我们将探讨因果推断与机器学习的结合。</em></p>
            </article>
            
            <nav class="page-nav"><a href="chapter12.html" class="nav-link prev">← 第十二章：因果发现</a><a href="chapter14.html" class="nav-link next">第十四章：因果推断与机器学习 →</a></nav>
        </main>
    </div>
</body>
</html>