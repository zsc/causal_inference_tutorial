# 第九章：中介分析与路径分析

在因果推断中，我们不仅关心处理对结果的总体影响，更想理解这种影响是如何产生的——通过什么机制或路径实现。中介分析（Mediation Analysis）为我们提供了打开因果"黑箱"的钥匙，帮助我们理解因果效应的传导机制。本章将系统介绍中介分析的理论框架、识别策略、敏感性分析方法，以及在复杂场景下的应用。

## 9.1 直接效应与间接效应

### 9.1.1 因果路径的分解

考虑一个简单的因果链：处理变量 $T$ 通过中介变量 $M$ 影响结果变量 $Y$。这个过程可以用以下因果图表示：

```
    T → M → Y
    ↘     ↗
      直接
```

在这个框架下，$T$ 对 $Y$ 的总效应（Total Effect, TE）可以分解为：
- **直接效应（Direct Effect, DE）**：$T$ 不经过 $M$ 直接对 $Y$ 的影响
- **间接效应（Indirect Effect, IE）**：$T$ 通过 $M$ 对 $Y$ 的影响

数学上，总效应可以表示为：
$$\text{TE} = \text{DE} + \text{IE}$$

### 9.1.2 Baron-Kenny方法

Baron和Kenny（1986）提出的经典中介分析方法基于线性回归模型：

**步骤1**：检验 $T$ 对 $Y$ 的总效应
$$Y = c \cdot T + e_1$$

**步骤2**：检验 $T$ 对 $M$ 的效应
$$M = a \cdot T + e_2$$

**步骤3**：同时纳入 $T$ 和 $M$ 预测 $Y$
$$Y = c' \cdot T + b \cdot M + e_3$$

其中：
- 总效应 = $c$
- 直接效应 = $c'$
- 间接效应 = $a \times b$

### 9.1.3 Baron-Kenny方法的局限性

尽管Baron-Kenny方法直观易懂，但存在重要局限：

1. **线性假设**：假设所有关系都是线性的，无法处理非线性关系
2. **无交互作用**：假设处理和中介变量之间没有交互作用
3. **时序混淆**：没有明确考虑变量的时间顺序
4. **因果识别不足**：缺乏对混杂因素的系统考虑

## 9.2 中介效应的识别

### 9.2.1 潜在结果框架下的中介分析

使用Rubin因果模型的潜在结果框架，我们可以更严格地定义中介效应。对于每个个体 $i$，定义：
- $Y_i(t, m)$：当处理为 $t$，中介变量为 $m$ 时的潜在结果
- $M_i(t)$：当处理为 $t$ 时中介变量的潜在值

### 9.2.2 自然直接效应与间接效应

**自然直接效应（Natural Direct Effect, NDE）**定义为：
$$\text{NDE} = E[Y(1, M(0)) - Y(0, M(0))]$$

这表示保持中介变量在控制条件下的"自然"水平时，处理对结果的直接影响。

**自然间接效应（Natural Indirect Effect, NIE）**定义为：
$$\text{NIE} = E[Y(1, M(1)) - Y(1, M(0))]$$

这表示在处理条件下，中介变量变化带来的间接影响。

总效应可以分解为：
$$\text{TE} = E[Y(1, M(1)) - Y(0, M(0))] = \text{NDE} + \text{NIE}$$

### 9.2.3 控制直接效应与间接效应

**控制直接效应（Controlled Direct Effect, CDE）**定义为：
$$\text{CDE}(m) = E[Y(1, m) - Y(0, m)]$$

这表示将中介变量固定在特定水平 $m$ 时的直接效应。

CDE与NDE的区别在于：
- CDE：人为固定中介变量的值
- NDE：允许中介变量取其"自然"值

### 9.2.4 识别假设

中介效应的因果识别需要以下关键假设：

1. **无未测量混杂假设**：
   - $(Y(t,m), M(t)) \perp\!\!\!\perp T | X$
   - $Y(t,m) \perp\!\!\!\perp M | T, X$

2. **时序一致性假设**：处理发生在中介变量之前，中介变量发生在结果之前

3. **交叉世界独立性假设**：
   $$Y(t, m) \perp\!\!\!\perp M(t') | X \quad \text{for all } t, t', m$$

这是一个强假设，要求不同处理水平下的潜在结果和潜在中介变量值相互独立。

## 9.3 敏感性分析

中介分析的识别假设往往难以完全满足，特别是无未测量混杂假设。敏感性分析帮助我们评估违反这些假设时结论的稳健性。

### 9.3.1 未测量混杂的影响

考虑存在未测量混杂因素 $U$ 影响中介变量和结果：

```
    T → M → Y
        ↑   ↑
        U ──┘
```

这种情况下，传统的中介分析会产生偏差。敏感性分析的核心是量化这种偏差的大小。

### 9.3.2 敏感性参数

定义敏感性参数 $\rho$ 表示残差相关性：
$$\rho = \text{Corr}(\epsilon_M, \epsilon_Y)$$

其中 $\epsilon_M$ 和 $\epsilon_Y$ 分别是中介变量和结果变量回归模型的残差。

在线性模型下，间接效应的偏差可以表示为：
$$\text{Bias}(\hat{IE}) = \rho \cdot \sigma_M \cdot \sigma_Y \cdot \frac{1}{\text{Var}(M|T,X)}$$

### 9.3.3 敏感性分析的实施步骤

1. **设定敏感性参数范围**：例如 $\rho \in [-0.3, 0.3]$
2. **计算不同参数值下的效应估计**：对每个 $\rho$ 值重新计算间接效应
3. **绘制敏感性图**：展示效应估计如何随敏感性参数变化
4. **确定稳健性区间**：找出使结论改变的参数阈值

### 9.3.4 基于E-value的敏感性分析

E-value是评估未测量混杂强度的另一种方法。对于中介分析，我们可以计算：
- 使间接效应变为零所需的最小混杂强度
- 使直接效应变为零所需的最小混杂强度

E-value越大，说明结果对未测量混杂越稳健。

## 9.4 多重中介模型

实际应用中，因果效应往往通过多个中介变量传导。多重中介模型帮助我们理解复杂的因果机制。

### 9.4.1 并行中介模型

在并行中介模型中，多个中介变量独立地传导处理效应：

```
      ┌→ M1 →┐
    T →  M2  → Y
      └→ M3 →┘
```

总的间接效应等于各路径间接效应之和：
$$\text{IE}_{\text{total}} = \text{IE}_{M1} + \text{IE}_{M2} + \text{IE}_{M3}$$

### 9.4.2 串行中介模型

在串行中介模型中，中介变量之间存在因果关系：

```
    T → M1 → M2 → Y
    ↘       ↗
      直接
```

这种模型需要考虑：
- $T \to M1 \to Y$ 的间接效应
- $T \to M1 \to M2 \to Y$ 的间接效应
- $T \to M2 \to Y$ 的间接效应（如果存在）

### 9.4.3 效应分解策略

对于复杂的多重中介模型，可以采用以下策略：

1. **逐步分解法**：逐个添加中介变量，观察效应变化
2. **路径分析法**：计算每条因果路径的贡献
3. **结构方程模型**：使用SEM同时估计所有路径

### 9.4.4 识别挑战

多重中介模型面临额外的识别挑战：
- **中介变量间的混杂**：需要控制影响多个中介变量的共同因素
- **时序关系**：确保中介变量的时间顺序正确
- **交互效应**：处理与不同中介变量的交互作用

## 9.5 行业案例：字节跳动内容质量对用户留存的影响机制

### 背景

字节跳动的短视频平台需要理解内容质量如何影响用户留存。管理层假设：高质量内容不仅直接提升用户满意度，还通过增加用户互动（点赞、评论、分享）间接影响留存率。

### 因果问题

- **处理变量（T）**：内容质量得分（基于算法评估的0-100分）
- **中介变量（M）**：用户互动率（点赞+评论+分享的综合指标）
- **结果变量（Y）**：7日留存率
- **协变量（X）**：用户画像、历史行为、时间特征等

### 因果图

```
内容质量 → 用户互动 → 7日留存
    ↘                ↗
         直接效应
    
潜在混杂：
- 用户偏好 → 内容质量选择 & 留存
- 时间趋势 → 互动率 & 留存
```

### 分析策略

**第一步：数据准备**
- 收集100万用户的观看记录
- 计算每个用户接触内容的平均质量分
- 统计用户互动行为
- 追踪7日留存情况

**第二步：识别策略**
利用推荐算法的随机性作为准实验：
- 算法会随机展示不同质量的内容给用户
- 控制用户特征后，内容质量分配近似随机

**第三步：中介分析**
```
1. 总效应模型：
   留存 = β₀ + β₁·内容质量 + γ·协变量 + ε
   
2. 中介变量模型：
   互动率 = α₀ + α₁·内容质量 + δ·协变量 + ε
   
3. 完整模型：
   留存 = θ₀ + θ₁·内容质量 + θ₂·互动率 + λ·协变量 + ε
```

### 分析结果

**效应分解**：
- 总效应：内容质量每提升10分，留存率提升2.5%
- 直接效应：1.0%（40%）
- 间接效应（通过互动）：1.5%（60%）

**路径分析**：
- 内容质量 → 互动率：质量每提升10分，互动率提升15%
- 互动率 → 留存：互动率每提升10%，留存率提升1%

**异质性分析**：
- 新用户：间接效应占比更高（70%）
- 老用户：直接效应占比更高（55%）

### 敏感性分析

考虑未测量的用户兴趣偏好可能同时影响互动和留存：

1. **基准估计**：间接效应 = 1.5%
2. **敏感性测试**：
   - 弱混杂（ρ=0.1）：间接效应 = 1.3%
   - 中等混杂（ρ=0.2）：间接效应 = 1.1%
   - 强混杂（ρ=0.3）：间接效应 = 0.9%

结论：即使存在中等程度的未测量混杂，间接效应仍然显著。

### 业务启示

1. **内容策略**：提升内容质量是提高留存的有效手段
2. **互动设计**：优化互动功能可以放大内容质量的效果
3. **用户分层**：对新用户应更注重互动引导
4. **算法优化**：推荐算法应同时考虑内容质量和互动潜力

## 本章小结

中介分析是理解因果机制的重要工具，它帮助我们打开因果效应的"黑箱"，理解处理如何通过中间变量影响最终结果。

### 核心概念回顾

1. **效应分解**：
   - 总效应 = 直接效应 + 间接效应
   - 自然效应 vs 控制效应

2. **识别条件**：
   - 无未测量混杂假设
   - 时序一致性
   - 交叉世界独立性

3. **关键公式**：
   - 自然直接效应：$\text{NDE} = E[Y(1, M(0)) - Y(0, M(0))]$
   - 自然间接效应：$\text{NIE} = E[Y(1, M(1)) - Y(1, M(0))]$
   - Baron-Kenny分解：$c = c' + ab$

4. **敏感性分析**：
   - 评估未测量混杂的影响
   - 使用敏感性参数和E-value
   - 确定结论的稳健性边界

5. **多重中介**：
   - 并行中介：多条独立路径
   - 串行中介：级联效应
   - 复杂网络的路径分析

### 实践要点

- 中介分析需要强假设，实践中应谨慎解释
- 敏感性分析是必不可少的稳健性检验
- 时间顺序和理论支撑对因果解释至关重要
- 多重中介模型能更真实地反映复杂机制